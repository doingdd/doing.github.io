<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <meta name="author" content="doing"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="shortcut icon" href="https://raw.githubusercontent.com/doingdd/img/master/dd.png" /> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://localhost:4000/2017/05/05/Python-library-logging.html"> <!-- Begin Jekyll SEO tag v2.2.2 --> <title>Python标准库 – logging | doing blog</title> <meta property="og:title" content="Python标准库 – logging" /> <meta name="author" content="doing" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="本文介绍python标准库，先从最基本的开始，主要参考: Logging HOWTO 1. 什么时候用logging logging提供了几个方便的function，包括debug(), info(), warning(), error()和critical(). 关于具体的使用时机，guide上给出了下面这个表格： 想要执行的任务 适合的tool 显示命令行工具或者程序的标准输出 print() 程序运行时正常的事件记录(例如错误分析时的状态监测) logging.info()(或logging.debug()显示详细信息) 针对运行的事件的警告 warning.warn():如果问题可避免，而且应该被修复。logging.warnig(): 如果软件无法修复，但仍需注意的问题。 运行的事件错误 raise an exception抛出异常 报告错误但无需抛出异常(例如长时间运行的进程错误) logging.error(),logging.exception()或logging.critical() logging function 的级别介绍(按重要级别递增)： level numerical level 使用情景 DEBUG 10 细节信息，常用于诊断问题 INFO 20 正常工作的确认信息 WARNING 30 不希望的事件已经发生或者即将发生，但仍然正常运行 ERROR 40 由于更严重的问题，软件不能执行某些功能 CRITICAL 50 严重问题，软件无法运行 默认的level是warning，高于warning级别的log会显示 例： &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.warning(&#39;Watch out!&#39;) WARNING:root:Watch out! &gt;&gt;&gt; logging.info(&#39;I told you so&#39;) &gt;&gt;&gt; info信息默认不会显示 2. 介绍logging的 Module-Level Functions logging to a file 设置默认level为DEBUG，并输出到文件, 所有logging信息都可以打印出来。这个例子涉及到了logging.basicConfig(),logging.debug()等等. &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(filename=&#39;example.log&#39;, level=logging.DEBUG) &gt;&gt;&gt; logging.debug(&#39;This message should go to the log file&#39;) &gt;&gt;&gt; logging.info(&#39;This is an info log line&#39;) &gt;&gt;&gt; logging.critical(&#39;Wow, critical&#39;) &gt;&gt;&gt; logging.error(&#39;ha&#39;) &gt;&gt;&gt; logging.error(&#39;There is an error&#39;) &gt;&gt;&gt; logging.warning(&#39;Warn: &#39;) [root@localhost ~]# cat example.log DEBUG:root:This message should go to the log file INFO:root:This is an info log line CRITICAL:root:Wow, critical ERROR:root:ha ERROR:root:There is an error WARNING:root:Warn: logging.basicConfig函数各参数: filename: 指定日志文件名 filemode: 和file函数意义相同，指定日志文件的打开模式，’w’或’a’ format: 指定输出的格式和内容，format可以输出很多有用信息，如上例所示: %(levelno)s: 打印日志级别的数值 %(levelname)s: 打印日志级别名称 %(pathname)s: 打印当前执行程序的路径，其实就是sys.argv[0] %(filename)s: 打印当前执行程序名 %(funcName)s: 打印日志的当前函数 %(lineno)d: 打印日志的当前行号 %(asctime)s: 打印日志的时间 %(thread)d: 打印线程ID %(threadName)s: 打印线程名称 %(process)d: 打印进程ID %(message)s: 打印日志信息 datefmt: 指定时间格式，同time.strftime() level: 设置日志级别，默认为logging.WARNING stream: 指定将日志的输出流，可以指定输出到sys.stderr,sys.stdout或者文件，默认输出到sys.stderr，当stream和filename同时指定时，stream被忽略 下面的例子是利用logging的level，获取它的数字level，并进行一些判断和处理，作用是可以让使用者自己定义log的level，用到了getattr这个内建函数： # assuming loglevel is bound to the string value obtained from the # command line argument. Convert to upper case to allow the user to # specify --log=DEBUG or --log=debug numeric_level = getattr(logging, loglevel.upper(), None) if not isinstance(numeric_level, int): raise ValueError(&#39;Invalid log level: %s&#39; % loglevel) logging.basicConfig(level=numeric_level, ...) 也可以设置log file每次写之前清除原有内容： logging.basicConfig(filename=&#39;example.log&#39;, filemode=&#39;w&#39;, level=logging.DEBUG) 上例中的getattr举例： &gt;&gt;&gt; getattr(logging,&#39;INFO&#39;) 20 #实际上就相当于： &gt;&gt;&gt; logging.INFO 20 getattr的作用就是返回对象的属性值。 logging 变量 &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(level=logging.INFO) &gt;&gt;&gt; my_name = &#39;doing&#39; &gt;&gt;&gt; logging.info(&#39;%s is my name&#39;, my_name) INFO:root:doing is my name 和print的标准字符串很像，只是格式有一点差异，而且，logging的输出支持str.format()和string.template,这种用法，放在string的文章中详细介绍。 logging显示格式和显示时间 &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(format=&#39;%(asctime)s %(levelname)s:%(message)s&#39;, &gt;&gt;&gt; logging.warning(&#39;Please notice the CPU utibily!&#39;) 2017-05-05 12:58:18,379 WARNING:Please notice the CPU utibily! 也可以更改时间格式： &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(format=&#39;%(asctime)s %(levelname)s:%(message)s&#39;, datefmt=&#39;%m/%d/%Y %I:%M:%S %p&#39;, level=logging.DEBUG) &gt;&gt;&gt; logging.warning(&#39;Please notice the CPU utibily!&#39;) 05/05/2017 01:06:22 PM WARNING:Please notice the CPU utibily! 更多的格式说明可以参考 time.strftime() 3. 介绍logging module的各个object logging模块主要包含几个部分：loggers, handlers, filters, formatters. loggers Logger 对象包括三类功能。 首先，提供几个方法接口以供应用调用并保存日志信息。 其次，根据重要性(默认筛选功能)或其他filter对象决定执行哪些log。 第三，logger 对象向其它相关的handler传递log。 总结起来，logger对象就是，保存log，筛选log和传递log，或者按照文档说法： 最普遍的用法有两方面： 配置和消息发送。 logger的常用的配置方法： Logger.setLevel()，顾名思义，设置log级别 Logger.addHandler(), Logger.removeHandler(),添加和删除handler对象给logger对象。 Logger.addFilter(), Logger.removeFilter(), 添加，删除filter对象。 logging.getLogger(),返回一个特定名字(默认为root)的logger实例的引用，名字是以.分隔的，有继承结构的。 当多个call以同一名字同时调用logging.getLogger()时，返回同一个logger对象。当名字时继承list里的下一级时，对应对象是上一级名字对应对象的继承。例如：logger 名字是foo的对象，是所有logger名字为foo.tar, foo.file, foo.pdf的上一级，后者是children。 例如： logger = logging.getLogger(__file__) 返回的是名字为当前文件名的logger对象，配置完成后可以输出log: logger.info(&#39;hi&#39;) Loggers 有一个explicit level的概念，就是Logger 对象必须有一个明确的级别，如果当前没有，则使用其父辈的level，一直往上找，直到找到root这个级别。这个级别用来决定当一个log事件发生时，是否将其传给handlers处理。 子loggers用其父类的loggers的handler发送消息，所以，不用给每一个logger配置handler，只需要给最高级的logger配置即可，当然，也可以set propagate 为False. Handlers Hanlder 对象 负责分派合适的log信息(根据logger的level)给特定的目的地。Logger对象可以通过addHandler()方法添加0个或多个handler对象。举例，如果需要log发送给文件，stdout和email，则需要配置三个handler，分别处理一个每一个location。 常用的handler可以参考： Useful Handlers 最常用的handler： logging.FileHandler(filename, mode=’a’, encoding=None, delay=False) 将log以指定模式存进指定文件 logging.StreamHandler(stream=None) 将log发送给标准流输出。 Formatters Formatter对象配置log信息的最后顺序，结构和内容。formatter有两个可选参数，信息的格式字符串和日期格式字符串。 logging.Formatter.__init__(fmt=None,datafmt=None) 举例： sys_fmt = &#39;%(asctime)s %(levelname)s %(filename)s:%(lineno)d %(processName)s MSGCLS=%(message)s&#39; datefmt = &#39;%Y%m%d%H%M%S&#39; sys_formatter = logging.Formatter(sys_fmt, datefmt) 如果没有message format string，则使用原始message，如果没有date format string，则使用如下格式： %Y-%m-%d %H:%M:%S后面再加上事件发生的毫秒数。 message format string的基本格式是**%(&lt;dictionary key&gt;)s**.如下例，列出了时间，级别和log内容： &#39;%(asctime)s - %(levelname)s - %(message)s&#39; Formatters默认使用time.localtime(),如果需要，可以设置converter属性为time.gmtime()，显示GMT格式的时间。 概念有点乱，上例子 定义logger： import logging logger = logging.getLogger(&#39;my_log&#39;) logger.setLevel(logging.DEBUG) 定义handler，这里既要存文件，又要打印输出： file_h = logging.FileHandler(&#39;test.log&#39;) file_h.setLevel(logging.DEBUG) console_h = logging.StreamHandler() console_h.setLevel(logging.DEBUG) 定义formatter，这里更改了默认的时间格式，不想输出毫秒。 formatter = logging.Formatter(&#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;) formatter.datefmt=&#39;%Y/%m/%d %H:%M:%S&#39; 把formatter给set给handler，再把handler赋给logger file_h.setFormatter(formatter) console_h.setFormatter(formatter) logger.addHandler(file_h) logger.addHandler(console_h) 最后 打印log： logger.debug(&#39;cool&#39;) logger.error(&#39;bad&#39;)" /> <meta property="og:description" content="本文介绍python标准库，先从最基本的开始，主要参考: Logging HOWTO 1. 什么时候用logging logging提供了几个方便的function，包括debug(), info(), warning(), error()和critical(). 关于具体的使用时机，guide上给出了下面这个表格： 想要执行的任务 适合的tool 显示命令行工具或者程序的标准输出 print() 程序运行时正常的事件记录(例如错误分析时的状态监测) logging.info()(或logging.debug()显示详细信息) 针对运行的事件的警告 warning.warn():如果问题可避免，而且应该被修复。logging.warnig(): 如果软件无法修复，但仍需注意的问题。 运行的事件错误 raise an exception抛出异常 报告错误但无需抛出异常(例如长时间运行的进程错误) logging.error(),logging.exception()或logging.critical() logging function 的级别介绍(按重要级别递增)： level numerical level 使用情景 DEBUG 10 细节信息，常用于诊断问题 INFO 20 正常工作的确认信息 WARNING 30 不希望的事件已经发生或者即将发生，但仍然正常运行 ERROR 40 由于更严重的问题，软件不能执行某些功能 CRITICAL 50 严重问题，软件无法运行 默认的level是warning，高于warning级别的log会显示 例： &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.warning(&#39;Watch out!&#39;) WARNING:root:Watch out! &gt;&gt;&gt; logging.info(&#39;I told you so&#39;) &gt;&gt;&gt; info信息默认不会显示 2. 介绍logging的 Module-Level Functions logging to a file 设置默认level为DEBUG，并输出到文件, 所有logging信息都可以打印出来。这个例子涉及到了logging.basicConfig(),logging.debug()等等. &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(filename=&#39;example.log&#39;, level=logging.DEBUG) &gt;&gt;&gt; logging.debug(&#39;This message should go to the log file&#39;) &gt;&gt;&gt; logging.info(&#39;This is an info log line&#39;) &gt;&gt;&gt; logging.critical(&#39;Wow, critical&#39;) &gt;&gt;&gt; logging.error(&#39;ha&#39;) &gt;&gt;&gt; logging.error(&#39;There is an error&#39;) &gt;&gt;&gt; logging.warning(&#39;Warn: &#39;) [root@localhost ~]# cat example.log DEBUG:root:This message should go to the log file INFO:root:This is an info log line CRITICAL:root:Wow, critical ERROR:root:ha ERROR:root:There is an error WARNING:root:Warn: logging.basicConfig函数各参数: filename: 指定日志文件名 filemode: 和file函数意义相同，指定日志文件的打开模式，’w’或’a’ format: 指定输出的格式和内容，format可以输出很多有用信息，如上例所示: %(levelno)s: 打印日志级别的数值 %(levelname)s: 打印日志级别名称 %(pathname)s: 打印当前执行程序的路径，其实就是sys.argv[0] %(filename)s: 打印当前执行程序名 %(funcName)s: 打印日志的当前函数 %(lineno)d: 打印日志的当前行号 %(asctime)s: 打印日志的时间 %(thread)d: 打印线程ID %(threadName)s: 打印线程名称 %(process)d: 打印进程ID %(message)s: 打印日志信息 datefmt: 指定时间格式，同time.strftime() level: 设置日志级别，默认为logging.WARNING stream: 指定将日志的输出流，可以指定输出到sys.stderr,sys.stdout或者文件，默认输出到sys.stderr，当stream和filename同时指定时，stream被忽略 下面的例子是利用logging的level，获取它的数字level，并进行一些判断和处理，作用是可以让使用者自己定义log的level，用到了getattr这个内建函数： # assuming loglevel is bound to the string value obtained from the # command line argument. Convert to upper case to allow the user to # specify --log=DEBUG or --log=debug numeric_level = getattr(logging, loglevel.upper(), None) if not isinstance(numeric_level, int): raise ValueError(&#39;Invalid log level: %s&#39; % loglevel) logging.basicConfig(level=numeric_level, ...) 也可以设置log file每次写之前清除原有内容： logging.basicConfig(filename=&#39;example.log&#39;, filemode=&#39;w&#39;, level=logging.DEBUG) 上例中的getattr举例： &gt;&gt;&gt; getattr(logging,&#39;INFO&#39;) 20 #实际上就相当于： &gt;&gt;&gt; logging.INFO 20 getattr的作用就是返回对象的属性值。 logging 变量 &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(level=logging.INFO) &gt;&gt;&gt; my_name = &#39;doing&#39; &gt;&gt;&gt; logging.info(&#39;%s is my name&#39;, my_name) INFO:root:doing is my name 和print的标准字符串很像，只是格式有一点差异，而且，logging的输出支持str.format()和string.template,这种用法，放在string的文章中详细介绍。 logging显示格式和显示时间 &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(format=&#39;%(asctime)s %(levelname)s:%(message)s&#39;, &gt;&gt;&gt; logging.warning(&#39;Please notice the CPU utibily!&#39;) 2017-05-05 12:58:18,379 WARNING:Please notice the CPU utibily! 也可以更改时间格式： &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(format=&#39;%(asctime)s %(levelname)s:%(message)s&#39;, datefmt=&#39;%m/%d/%Y %I:%M:%S %p&#39;, level=logging.DEBUG) &gt;&gt;&gt; logging.warning(&#39;Please notice the CPU utibily!&#39;) 05/05/2017 01:06:22 PM WARNING:Please notice the CPU utibily! 更多的格式说明可以参考 time.strftime() 3. 介绍logging module的各个object logging模块主要包含几个部分：loggers, handlers, filters, formatters. loggers Logger 对象包括三类功能。 首先，提供几个方法接口以供应用调用并保存日志信息。 其次，根据重要性(默认筛选功能)或其他filter对象决定执行哪些log。 第三，logger 对象向其它相关的handler传递log。 总结起来，logger对象就是，保存log，筛选log和传递log，或者按照文档说法： 最普遍的用法有两方面： 配置和消息发送。 logger的常用的配置方法： Logger.setLevel()，顾名思义，设置log级别 Logger.addHandler(), Logger.removeHandler(),添加和删除handler对象给logger对象。 Logger.addFilter(), Logger.removeFilter(), 添加，删除filter对象。 logging.getLogger(),返回一个特定名字(默认为root)的logger实例的引用，名字是以.分隔的，有继承结构的。 当多个call以同一名字同时调用logging.getLogger()时，返回同一个logger对象。当名字时继承list里的下一级时，对应对象是上一级名字对应对象的继承。例如：logger 名字是foo的对象，是所有logger名字为foo.tar, foo.file, foo.pdf的上一级，后者是children。 例如： logger = logging.getLogger(__file__) 返回的是名字为当前文件名的logger对象，配置完成后可以输出log: logger.info(&#39;hi&#39;) Loggers 有一个explicit level的概念，就是Logger 对象必须有一个明确的级别，如果当前没有，则使用其父辈的level，一直往上找，直到找到root这个级别。这个级别用来决定当一个log事件发生时，是否将其传给handlers处理。 子loggers用其父类的loggers的handler发送消息，所以，不用给每一个logger配置handler，只需要给最高级的logger配置即可，当然，也可以set propagate 为False. Handlers Hanlder 对象 负责分派合适的log信息(根据logger的level)给特定的目的地。Logger对象可以通过addHandler()方法添加0个或多个handler对象。举例，如果需要log发送给文件，stdout和email，则需要配置三个handler，分别处理一个每一个location。 常用的handler可以参考： Useful Handlers 最常用的handler： logging.FileHandler(filename, mode=’a’, encoding=None, delay=False) 将log以指定模式存进指定文件 logging.StreamHandler(stream=None) 将log发送给标准流输出。 Formatters Formatter对象配置log信息的最后顺序，结构和内容。formatter有两个可选参数，信息的格式字符串和日期格式字符串。 logging.Formatter.__init__(fmt=None,datafmt=None) 举例： sys_fmt = &#39;%(asctime)s %(levelname)s %(filename)s:%(lineno)d %(processName)s MSGCLS=%(message)s&#39; datefmt = &#39;%Y%m%d%H%M%S&#39; sys_formatter = logging.Formatter(sys_fmt, datefmt) 如果没有message format string，则使用原始message，如果没有date format string，则使用如下格式： %Y-%m-%d %H:%M:%S后面再加上事件发生的毫秒数。 message format string的基本格式是**%(&lt;dictionary key&gt;)s**.如下例，列出了时间，级别和log内容： &#39;%(asctime)s - %(levelname)s - %(message)s&#39; Formatters默认使用time.localtime(),如果需要，可以设置converter属性为time.gmtime()，显示GMT格式的时间。 概念有点乱，上例子 定义logger： import logging logger = logging.getLogger(&#39;my_log&#39;) logger.setLevel(logging.DEBUG) 定义handler，这里既要存文件，又要打印输出： file_h = logging.FileHandler(&#39;test.log&#39;) file_h.setLevel(logging.DEBUG) console_h = logging.StreamHandler() console_h.setLevel(logging.DEBUG) 定义formatter，这里更改了默认的时间格式，不想输出毫秒。 formatter = logging.Formatter(&#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;) formatter.datefmt=&#39;%Y/%m/%d %H:%M:%S&#39; 把formatter给set给handler，再把handler赋给logger file_h.setFormatter(formatter) console_h.setFormatter(formatter) logger.addHandler(file_h) logger.addHandler(console_h) 最后 打印log： logger.debug(&#39;cool&#39;) logger.error(&#39;bad&#39;)" /> <link rel="canonical" href="http://localhost:4000/2017/05/05/Python-library-logging.html" /> <meta property="og:url" content="http://localhost:4000/2017/05/05/Python-library-logging.html" /> <meta property="og:site_name" content="doing blog" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2017-05-05T00:00:00-04:00" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@doing" /> <script type="application/ld+json"> {"@context":"http://schema.org","@type":"BlogPosting","headline":"Python标准库 – logging","author":{"@type":"Person","name":"doing"},"datePublished":"2017-05-05T00:00:00-04:00","dateModified":"2017-05-05T00:00:00-04:00","description":"本文介绍python标准库，先从最基本的开始，主要参考: Logging HOWTO 1. 什么时候用logging logging提供了几个方便的function，包括debug(), info(), warning(), error()和critical(). 关于具体的使用时机，guide上给出了下面这个表格： 想要执行的任务 适合的tool 显示命令行工具或者程序的标准输出 print() 程序运行时正常的事件记录(例如错误分析时的状态监测) logging.info()(或logging.debug()显示详细信息) 针对运行的事件的警告 warning.warn():如果问题可避免，而且应该被修复。logging.warnig(): 如果软件无法修复，但仍需注意的问题。 运行的事件错误 raise an exception抛出异常 报告错误但无需抛出异常(例如长时间运行的进程错误) logging.error(),logging.exception()或logging.critical() logging function 的级别介绍(按重要级别递增)： level numerical level 使用情景 DEBUG 10 细节信息，常用于诊断问题 INFO 20 正常工作的确认信息 WARNING 30 不希望的事件已经发生或者即将发生，但仍然正常运行 ERROR 40 由于更严重的问题，软件不能执行某些功能 CRITICAL 50 严重问题，软件无法运行 默认的level是warning，高于warning级别的log会显示 例： &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.warning(&#39;Watch out!&#39;) WARNING:root:Watch out! &gt;&gt;&gt; logging.info(&#39;I told you so&#39;) &gt;&gt;&gt; info信息默认不会显示 2. 介绍logging的 Module-Level Functions logging to a file 设置默认level为DEBUG，并输出到文件, 所有logging信息都可以打印出来。这个例子涉及到了logging.basicConfig(),logging.debug()等等. &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(filename=&#39;example.log&#39;, level=logging.DEBUG) &gt;&gt;&gt; logging.debug(&#39;This message should go to the log file&#39;) &gt;&gt;&gt; logging.info(&#39;This is an info log line&#39;) &gt;&gt;&gt; logging.critical(&#39;Wow, critical&#39;) &gt;&gt;&gt; logging.error(&#39;ha&#39;) &gt;&gt;&gt; logging.error(&#39;There is an error&#39;) &gt;&gt;&gt; logging.warning(&#39;Warn: &#39;) [root@localhost ~]# cat example.log DEBUG:root:This message should go to the log file INFO:root:This is an info log line CRITICAL:root:Wow, critical ERROR:root:ha ERROR:root:There is an error WARNING:root:Warn: logging.basicConfig函数各参数: filename: 指定日志文件名 filemode: 和file函数意义相同，指定日志文件的打开模式，’w’或’a’ format: 指定输出的格式和内容，format可以输出很多有用信息，如上例所示: %(levelno)s: 打印日志级别的数值 %(levelname)s: 打印日志级别名称 %(pathname)s: 打印当前执行程序的路径，其实就是sys.argv[0] %(filename)s: 打印当前执行程序名 %(funcName)s: 打印日志的当前函数 %(lineno)d: 打印日志的当前行号 %(asctime)s: 打印日志的时间 %(thread)d: 打印线程ID %(threadName)s: 打印线程名称 %(process)d: 打印进程ID %(message)s: 打印日志信息 datefmt: 指定时间格式，同time.strftime() level: 设置日志级别，默认为logging.WARNING stream: 指定将日志的输出流，可以指定输出到sys.stderr,sys.stdout或者文件，默认输出到sys.stderr，当stream和filename同时指定时，stream被忽略 下面的例子是利用logging的level，获取它的数字level，并进行一些判断和处理，作用是可以让使用者自己定义log的level，用到了getattr这个内建函数： # assuming loglevel is bound to the string value obtained from the # command line argument. Convert to upper case to allow the user to # specify --log=DEBUG or --log=debug numeric_level = getattr(logging, loglevel.upper(), None) if not isinstance(numeric_level, int): raise ValueError(&#39;Invalid log level: %s&#39; % loglevel) logging.basicConfig(level=numeric_level, ...) 也可以设置log file每次写之前清除原有内容： logging.basicConfig(filename=&#39;example.log&#39;, filemode=&#39;w&#39;, level=logging.DEBUG) 上例中的getattr举例： &gt;&gt;&gt; getattr(logging,&#39;INFO&#39;) 20 #实际上就相当于： &gt;&gt;&gt; logging.INFO 20 getattr的作用就是返回对象的属性值。 logging 变量 &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(level=logging.INFO) &gt;&gt;&gt; my_name = &#39;doing&#39; &gt;&gt;&gt; logging.info(&#39;%s is my name&#39;, my_name) INFO:root:doing is my name 和print的标准字符串很像，只是格式有一点差异，而且，logging的输出支持str.format()和string.template,这种用法，放在string的文章中详细介绍。 logging显示格式和显示时间 &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(format=&#39;%(asctime)s %(levelname)s:%(message)s&#39;, &gt;&gt;&gt; logging.warning(&#39;Please notice the CPU utibily!&#39;) 2017-05-05 12:58:18,379 WARNING:Please notice the CPU utibily! 也可以更改时间格式： &gt;&gt;&gt; import logging &gt;&gt;&gt; logging.basicConfig(format=&#39;%(asctime)s %(levelname)s:%(message)s&#39;, datefmt=&#39;%m/%d/%Y %I:%M:%S %p&#39;, level=logging.DEBUG) &gt;&gt;&gt; logging.warning(&#39;Please notice the CPU utibily!&#39;) 05/05/2017 01:06:22 PM WARNING:Please notice the CPU utibily! 更多的格式说明可以参考 time.strftime() 3. 介绍logging module的各个object logging模块主要包含几个部分：loggers, handlers, filters, formatters. loggers Logger 对象包括三类功能。 首先，提供几个方法接口以供应用调用并保存日志信息。 其次，根据重要性(默认筛选功能)或其他filter对象决定执行哪些log。 第三，logger 对象向其它相关的handler传递log。 总结起来，logger对象就是，保存log，筛选log和传递log，或者按照文档说法： 最普遍的用法有两方面： 配置和消息发送。 logger的常用的配置方法： Logger.setLevel()，顾名思义，设置log级别 Logger.addHandler(), Logger.removeHandler(),添加和删除handler对象给logger对象。 Logger.addFilter(), Logger.removeFilter(), 添加，删除filter对象。 logging.getLogger(),返回一个特定名字(默认为root)的logger实例的引用，名字是以.分隔的，有继承结构的。 当多个call以同一名字同时调用logging.getLogger()时，返回同一个logger对象。当名字时继承list里的下一级时，对应对象是上一级名字对应对象的继承。例如：logger 名字是foo的对象，是所有logger名字为foo.tar, foo.file, foo.pdf的上一级，后者是children。 例如： logger = logging.getLogger(__file__) 返回的是名字为当前文件名的logger对象，配置完成后可以输出log: logger.info(&#39;hi&#39;) Loggers 有一个explicit level的概念，就是Logger 对象必须有一个明确的级别，如果当前没有，则使用其父辈的level，一直往上找，直到找到root这个级别。这个级别用来决定当一个log事件发生时，是否将其传给handlers处理。 子loggers用其父类的loggers的handler发送消息，所以，不用给每一个logger配置handler，只需要给最高级的logger配置即可，当然，也可以set propagate 为False. Handlers Hanlder 对象 负责分派合适的log信息(根据logger的level)给特定的目的地。Logger对象可以通过addHandler()方法添加0个或多个handler对象。举例，如果需要log发送给文件，stdout和email，则需要配置三个handler，分别处理一个每一个location。 常用的handler可以参考： Useful Handlers 最常用的handler： logging.FileHandler(filename, mode=’a’, encoding=None, delay=False) 将log以指定模式存进指定文件 logging.StreamHandler(stream=None) 将log发送给标准流输出。 Formatters Formatter对象配置log信息的最后顺序，结构和内容。formatter有两个可选参数，信息的格式字符串和日期格式字符串。 logging.Formatter.__init__(fmt=None,datafmt=None) 举例： sys_fmt = &#39;%(asctime)s %(levelname)s %(filename)s:%(lineno)d %(processName)s MSGCLS=%(message)s&#39; datefmt = &#39;%Y%m%d%H%M%S&#39; sys_formatter = logging.Formatter(sys_fmt, datefmt) 如果没有message format string，则使用原始message，如果没有date format string，则使用如下格式： %Y-%m-%d %H:%M:%S后面再加上事件发生的毫秒数。 message format string的基本格式是**%(&lt;dictionary key&gt;)s**.如下例，列出了时间，级别和log内容： &#39;%(asctime)s - %(levelname)s - %(message)s&#39; Formatters默认使用time.localtime(),如果需要，可以设置converter属性为time.gmtime()，显示GMT格式的时间。 概念有点乱，上例子 定义logger： import logging logger = logging.getLogger(&#39;my_log&#39;) logger.setLevel(logging.DEBUG) 定义handler，这里既要存文件，又要打印输出： file_h = logging.FileHandler(&#39;test.log&#39;) file_h.setLevel(logging.DEBUG) console_h = logging.StreamHandler() console_h.setLevel(logging.DEBUG) 定义formatter，这里更改了默认的时间格式，不想输出毫秒。 formatter = logging.Formatter(&#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;) formatter.datefmt=&#39;%Y/%m/%d %H:%M:%S&#39; 把formatter给set给handler，再把handler赋给logger file_h.setFormatter(formatter) console_h.setFormatter(formatter) logger.addHandler(file_h) logger.addHandler(console_h) 最后 打印log： logger.debug(&#39;cool&#39;) logger.error(&#39;bad&#39;)","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2017/05/05/Python-library-logging.html"},"url":"http://localhost:4000/2017/05/05/Python-library-logging.html"}</script> <!-- End Jekyll SEO tag --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="doing blog" /> <script src="/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar" class="open"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="https://raw.githubusercontent.com/doingdd/img/master/d.png"/> </a> <div id="sidebar-social"> <a href="/pages/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:doingduxuan@163.com" class="sidebar-social-icon email"></a> <!-- Generate icon by yourself https://icomoon.io/app/#/select --> <a href="https://twitter.com/masonsuyan" class="sidebar-social-icon twitter" target="_blank"></a> <a href="http://www.weibo.com/doingdd" class="sidebar-social-icon weibo" target="_blank"></a> <a href="https://github.com/doingdd" class="sidebar-social-icon github" target="_blank"></a> <a href="https://www.linkedin.com/in/doingdd" class="sidebar-social-icon linkedin" target="_blank"></a> <a href="https://www.instagram.com/doingdd" class="sidebar-social-icon instagram" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="recent">最新文章</li> <li class="sidebar-tag" data-filter="技术">技术</li> <li class="sidebar-tag" data-filter="工具">工具</li> <li class="sidebar-tag" data-filter="Linux">Linux</li> <li class="sidebar-tag" data-filter="Python">Python</li> <li class="sidebar-tag" data-filter="life">life</li> </ul> </div> <div id="sidebar-right"> <div id="search-box"> <input id="search-input" type="text" placeholder="Search" /> </div> <nav id="toc"> <a class="toc-link" data-tags="Linux" href="/2017/05/24/Linux-Shell-String.html"> Linux shell内置字符串操作 </a> <a class="toc-link" data-tags="Python" href="/2017/05/21/Python-library-argparse.html"> Python标准库 -- argparse </a> <a class="toc-link" data-tags="Python" href="/2017/05/20/Python-Q&A-2.html"> Python问答系列2 </a> <a class="toc-link" data-tags="Python" href="/2017/05/19/Python-Q&A-1.html"> Pyhon问答系列1 </a> <a class="toc-link" data-tags="Python" href="/2017/05/13/Python-library-json.html"> Python标准库 -- json </a> <a class="toc-link" data-tags="Python" href="/2017/05/05/Python-library-logging.html"> Python标准库 -- logging </a> <a class="toc-link" data-tags="Linux" href="/2017/05/04/Gnome-installation-on-CentOS.html"> centos 安装gnome和vnc </a> <a class="toc-link" data-tags="Python" href="/2017/05/03/Python-standard-library-tempfile.html"> Python标准库 -- tempfile </a> <a class="toc-link" data-tags="life" href="/2017/05/02/test-forms.html"> test forms </a> <a class="toc-link" data-tags="Python" href="/2017/05/01/Python-Iterator-Generator.html"> Python知识点 -- 迭代器和生成器 </a> <a class="toc-link" data-tags="Python" href="/2017/04/28/Python-lambda.html"> Python知识点 -- lambda表达式 </a> <a class="toc-link" data-tags="Linux" href="/2017/04/28/Linux-shell.html"> Linux中shell的理解和不同shell的区别 </a> <a class="toc-link" data-tags="Python" href="/2017/04/27/Python-practice-generator.html"> Python知识点 -- 装饰器 </a> <a class="toc-link" data-tags="Linux" href="/2017/04/25/linux-value.html"> Linux 环境变量 </a> <a class="toc-link" data-tags="Python" href="/2017/04/20/Python-practice-value-and-copy.html"> Python知识点 -- 变量赋值与深浅copy </a> <a class="toc-link" data-tags="Python" href="/2017/04/19/Difference-between-python2-and-python3.html"> Python2和Python3的区别 </a> <a class="toc-link" data-tags="Linux" href="/2017/04/19/Linux-content-tree.html"> Linux 目录结构 </a> <a class="toc-link" data-tags="Python" href="/2017/04/14/Python-file-process.html"> Python IO 文件处理 </a> <a class="toc-link" data-tags="Python" href="/2017/04/13/Python-list-usage.html"> Python list usage </a> <a class="toc-link" data-tags="Linux" href="/2017/03/29/basic-linux-usage.html"> Linux 基础命令 </a> <a class="toc-link" data-tags="工具" href="/2017/02/21/docker-summary.html"> Docker 使用总结 </a> <a class="toc-link" data-tags="工具" href="/2016/12/31/deploy-shadowsocks-on-ubuntu.html"> 在 Ubuntu 下部署 Shadowsocks </a> <a class="toc-link" data-tags="工具" href="/2016/12/30/deploy-l2tp-on-ubuntu.html"> 在 Ubuntu 下部署 L2TP VPN </a> <a class="toc-link" data-tags="工具" href="/2016/11/09/my-writing-tools.html"> 我使用的收藏，写作和分享工具 </a> <a class="toc-link" data-tags="技术" href="/2015/09/07/sort-algorithms.html"> 七种常见经典排序算法总结（C++实现） </a> <a class="toc-link" data-tags="工具" href="/2015/01/10/use-dropzone-and-qiniu-to-store-blog-images.html"> 使用Dropzone和七牛优化博客图床 </a> <a class="toc-link" data-tags="技术" href="/2014/04/16/insert-large-number-of-data-in-mysql.html"> MySQL大量数据插入方法性能分析比较 </a> <a class="toc-link" data-tags="工具" href="/2014/04/10/install-vagrant-in-mac.html"> 在Mac下安装使用Vagrant </a> <a class="toc-link" data-tags="工具" href="/2014/03/20/php-debug-with-xdebug.html"> 用Xdebug和Sublime调试PHP代码 </a> <a class="toc-link" data-tags="工具" href="/2014/02/12/how-to-deploy-a-blog-on-github-by-jekyll.html"> 在Github上搭建Jekyll博客和创建主题 </a> <a class="toc-link" data-tags="技术" href="/2014/01/30/understanding-the-github-workflow.html"> 了解GitHub工作流【译】 </a> <a class="toc-link" data-tags="技术" href="/2014/01/17/python-script-of-sae-log-download.html"> Python脚本--下载合并SAE日志 </a> <a class="toc-link" data-tags="工具" href="/2013/12/11/lamp-in-mac.html"> Mac下用brew搭建LNMP和LAMP开发环境 </a> <a class="toc-link" data-tags="工具" href="/2013/12/11/deploy-pptp-vpn-in-ubuntu.html"> 在ubuntu下搭建pptp vpn服务器 </a> <a class="toc-link" data-tags="工具" href="/2013/12/08/linux-command-continue.html"> Linux下多个命令连续执行方法 </a> <a class="toc-link" data-tags="技术" href="/2013/10/01/deploy-ceilometer-of-openstack.html"> 部署Ceilometer到已有环境中 </a> <a class="toc-link" data-tags="工具" href="/2013/08/28/change-bootstrap-to-3.html"> 更新前端框架到Bootstrap3 </a> <a class="toc-link" data-tags="工具" href="/2013/08/06/tools-of-reading.html"> 我与工具--阅读和知识管理 </a> <a class="toc-link" data-tags="工具" href="/2013/08/04/something-about-tools-i-used.html"> 我与工具 </a> <a class="toc-link" data-tags="技术" href="/2013/06/12/hacking-in-openstack-ceilometer-collector.html"> OpenStack Ceilometer Collector代码解读 </a> <a class="toc-link" data-tags="技术" href="/2013/06/12/hacking-in-openstack-ceilometer-api.html"> OpenStack Ceilometer数据与API源码详解 </a> <a class="toc-link" data-tags="技术" href="/2013/06/11/pipeline-of-openstack-ceilometer.html"> OpenStack Ceilometer Pipeline代码解读 </a> <a class="toc-link" data-tags="技术" href="/2013/06/11/hacking-in-openstack-ceilometer-compute-agent.html"> OpenStack Ceilometer Agent源码解读 </a> <a class="toc-link" data-tags="技术" href="/2013/06/09/learn-python-stevedore-module-in-detail.html"> 学习Python动态扩展包stevedore </a> <a class="toc-link" data-tags="技术" href="/2013/06/09/learn-python-abc-module.html"> 学习Python的ABC模块 </a> <a class="toc-link" data-tags="技术" href="/2013/06/07/learn-python-setuptools-in-detail.html"> Python包管理工具setuptools详解 </a> <a class="toc-link" data-tags="技术" href="/2013/05/27/openstack-horizon-locale.html"> OpenStack Horizon 中文本地化 </a> <a class="toc-link" data-tags="工具" href="/2013/05/23/install-mysql-and-mongo-web-admin.html"> 安装MySQL和MongoDB的WEB管理界面 </a> <a class="toc-link" data-tags="工具" href="/2013/05/22/change-to-zsh.html"> 从Bash切换到Zsh </a> <a class="toc-link" data-tags="工具" href="/2013/05/20/set-proxy-for-git-or-apt.html"> 给Git或者APT设置goagent代理 </a> <a class="toc-link" data-tags="技术" href="/2013/05/19/what-is-wsgi.html"> WSGI学习 </a> <a class="toc-link" data-tags="技术" href="/2013/05/16/deploy-openstack-grizzly-in-virtual-machine.html"> 在虚拟机单机部署OpenStack Grizzly </a> <a class="toc-link" data-tags="技术" href="/2013/05/15/learn-how-to-use-distutils.html"> 学习使用python打包工具distutils </a> <a class="toc-link" data-tags="技术" href="/2013/05/15/different-between-python-package-tools.html"> python包工具之间的关系 </a> <a class="toc-link" data-tags="技术" href="/2013/05/15/create-ubuntu-image-for-openstack.html"> 给OpenStack创建Ubuntu镜像 </a> <a class="toc-link" data-tags="技术" href="/2013/05/13/openstack-grizzly-multihost-deployment-doc.html"> OpenStack Grizzly Multihost部署文档 </a> <a class="toc-link" data-tags="技术" href="/2013/05/06/why-use-pip-over-easy-install.html"> 为什么使用pip而不是easy_install </a> <a class="toc-link" data-tags="技术" href="/2013/05/06/interactive-coding-ipython.html"> 交互式编程-IPython </a> <a class="toc-link" data-tags="技术" href="/2013/05/03/create-windows-7-image-for-openstack.html"> 给OpenStack创建Win7镜像 </a> <a class="toc-link" data-tags="技术" href="/2013/05/01/terminal-command-of-ceilometer.html"> Ceilometer的命令行使用 </a> <a class="toc-link" data-tags="技术" href="/2013/05/01/deploy-a-ceilometer-horizon-project.html"> 部署一个ceilometer-horizon项目 </a> <a class="toc-link" data-tags="技术" href="/2013/04/26/create-windows-xp-image-for-openstack.html"> 给OpenStack创建Windows XP镜像 </a> <a class="toc-link" data-tags="工具" href="/2013/04/22/wordpress-to-jekyll.html"> 博客迁移完成 </a> <a class="toc-link" data-tags="工具" href="/2013/04/22/ignore-password-in-git-push.html"> 让git push命令不再需要密码 </a> <a class="toc-link" data-tags="工具" href="/2013/04/22/highlight-of-jekyll.html"> Jekyll的中的代码高亮 </a> <a class="toc-link" data-tags="工具" href="/2013/04/22/add-svn-ignore-file.html"> 给SVN控制的项目添加忽略文件/文件夹 </a> <a class="toc-link" data-tags="工具" href="/2013/04/21/add-snippet.html"> 给sublime增加snippet </a> <a class="toc-link" data-tags="技术" href="/2013/03/27/glossary-of-ceilometer.html"> OpenStack Ceilometer的一些术语 </a> <a class="toc-link" data-tags="工具" href="/2013/03/25/tools-of-sever-deployment.html"> 服务器自动化部署及运维常见工具 </a> <a class="toc-link" data-tags="工具" href="/2013/03/25/open-tcp-port-of-libvirt.html"> Linux下开启Libvirtd的tcp监控 </a> <a class="toc-link" data-tags="技术" href="/2013/03/21/vnc-vs-rdp.html"> VNC和远程桌面的区别 </a> <a class="toc-link" data-tags="技术" href="/2013/03/21/introduction-of-ceilometer.html"> OpenStack Ceilometer项目简介 </a> <a class="toc-link" data-tags="技术" href="/2013/03/20/different-bewteen-kvm-xen-qemu.html"> 虚拟化中KVM, Xen, Qemu的区别 </a> <a class="toc-link" data-tags="技术" href="/2013/03/20/debug-and-modify-openstack-horizon.html"> 调试和修改OpenStack中的Horizon部分 </a> <a class="toc-link" data-tags="工具" href="/2013/02/25/quick-open-in-windows.html"> win7快速打开应用程序或文件 </a> <a class="toc-link" data-tags="工具" href="/2013/01/16/create-remote-resp.html"> git创建远程库 </a> <a class="toc-link" data-tags="工具" href="/2013/01/09/remote-access-of-mysql.html"> MySQL远程访问 </a> <a class="toc-link" data-tags="工具" href="/2012/12/30/share-windows-and-linux.html"> Windows和Linux切换最终解决方案 </a> <a class="toc-link" data-tags="技术" href="/2012/11/08/openstack-nova-internal.html"> OpenStack Nova内部机制【译】 </a> </nav> </div> </aside> <main id="main" class="open"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2017 May 05</span> </div> <h1 class="post-title">Python标准库 -- logging</h1> <p><strong>本文介绍python标准库，先从最基本的开始，主要参考: <a href="https://docs.python.org/2/howto/logging.html#logging-basic-tutorial">Logging HOWTO</a></strong></p> <h1 id="1-什么时候用logging">1. 什么时候用logging</h1> <p>logging提供了几个方便的function，包括debug(), info(), warning(), error()和critical(). 关于具体的使用时机，guide上给出了下面这个表格：</p> <table> <thead> <tr> <th>想要执行的任务</th> <th>适合的tool</th> </tr> </thead> <tbody> <tr> <td>显示命令行工具或者程序的标准输出</td> <td>print()</td> </tr> <tr> <td>程序运行时正常的事件记录(例如错误分析时的状态监测)</td> <td>logging.info()(或logging.debug()显示详细信息)</td> </tr> <tr> <td>针对运行的事件的警告</td> <td>warning.warn():如果问题可避免，而且应该被修复。logging.warnig(): 如果软件无法修复，但仍需注意的问题。</td> </tr> <tr> <td>运行的事件错误</td> <td>raise an exception抛出异常</td> </tr> <tr> <td>报告错误但无需抛出异常(例如长时间运行的进程错误)</td> <td>logging.error(),logging.exception()或logging.critical()</td> </tr> </tbody> </table> <p>logging function 的级别介绍(按重要级别递增)：</p> <table> <thead> <tr> <th style="text-align: center">level</th> <th style="text-align: center">numerical level</th> <th style="text-align: left">使用情景</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">DEBUG</td> <td style="text-align: center">10</td> <td style="text-align: left">细节信息，常用于诊断问题</td> </tr> <tr> <td style="text-align: center">INFO</td> <td style="text-align: center">20</td> <td style="text-align: left">正常工作的确认信息</td> </tr> <tr> <td style="text-align: center">WARNING</td> <td style="text-align: center">30</td> <td style="text-align: left">不希望的事件已经发生或者即将发生，但仍然正常运行</td> </tr> <tr> <td style="text-align: center">ERROR</td> <td style="text-align: center">40</td> <td style="text-align: left">由于更严重的问题，软件不能执行某些功能</td> </tr> <tr> <td style="text-align: center">CRITICAL</td> <td style="text-align: center">50</td> <td style="text-align: left">严重问题，软件无法运行</td> </tr> </tbody> </table> <p>默认的level是warning，高于warning级别的log会显示 例：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">logging</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">'Watch out!'</span><span class="p">)</span>
<span class="n">WARNING</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="n">Watch</span> <span class="n">out</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'I told you so'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> 
</code></pre></div> <p>info信息默认不会显示</p> <h1 id="2-介绍logging的-module-level-functions">2. 介绍logging的 Module-Level Functions</h1> <h2 id="logging-to-a-file">logging to a file</h2> <p>设置默认level为DEBUG，并输出到文件, 所有logging信息都可以打印出来。这个例子涉及到了<code class="highlighter-rouge">logging.basicConfig()</code>,<code class="highlighter-rouge">logging.debug()</code>等等.</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">logging</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">'example.log'</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">'This message should go to the log file'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'This is an info log line'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">'Wow, critical'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">'ha'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">'There is an error'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">'Warn: '</span><span class="p">)</span>

<span class="p">[</span><span class="n">root</span><span class="nd">@localhost</span> <span class="o">~</span><span class="p">]</span><span class="c"># cat example.log </span>
<span class="n">DEBUG</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="n">This</span> <span class="n">message</span> <span class="n">should</span> <span class="n">go</span> <span class="n">to</span> <span class="n">the</span> <span class="n">log</span> <span class="nb">file</span>
<span class="n">INFO</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="n">This</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">info</span> <span class="n">log</span> <span class="n">line</span>
<span class="n">CRITICAL</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="n">Wow</span><span class="p">,</span> <span class="n">critical</span>
<span class="n">ERROR</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="n">ha</span>
<span class="n">ERROR</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="n">There</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">error</span>
<span class="n">WARNING</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="n">Warn</span><span class="p">:</span> 
</code></pre></div> <p>logging.basicConfig函数各参数:<br /> <code class="highlighter-rouge">filename</code>: 指定日志文件名<br /> <code class="highlighter-rouge">filemode</code>: 和file函数意义相同，指定日志文件的打开模式，’w’或’a’<br /> <code class="highlighter-rouge">format</code>: 指定输出的格式和内容，format可以输出很多有用信息，如上例所示:<br /> <code class="highlighter-rouge">%(levelno)s</code>: 打印日志级别的数值<br /> <code class="highlighter-rouge">%(levelname)s</code>: 打印日志级别名称<br /> <code class="highlighter-rouge">%(pathname)s</code>: 打印当前执行程序的路径，其实就是sys.argv[0]<br /> <code class="highlighter-rouge">%(filename)s</code>: 打印当前执行程序名<br /> <code class="highlighter-rouge">%(funcName)s</code>: 打印日志的当前函数<br /> <code class="highlighter-rouge">%(lineno)d</code>: 打印日志的当前行号<br /> <code class="highlighter-rouge">%(asctime)s</code>: 打印日志的时间<br /> <code class="highlighter-rouge">%(thread)d</code>: 打印线程ID<br /> <code class="highlighter-rouge">%(threadName)s</code>: 打印线程名称<br /> <code class="highlighter-rouge">%(process)d</code>: 打印进程ID<br /> <code class="highlighter-rouge">%(message)s</code>: 打印日志信息<br /> datefmt: 指定时间格式，同time.strftime()<br /> level: 设置日志级别，默认为logging.WARNING<br /> stream: 指定将日志的输出流，可以指定输出到sys.stderr,sys.stdout或者文件，默认输出到sys.stderr，当stream和filename同时指定时，stream被忽略</p> <p>下面的例子是利用logging的level，获取它的数字level，并进行一些判断和处理，作用是可以让使用者自己定义log的level，用到了getattr这个内建函数：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># assuming loglevel is bound to the string value obtained from the</span>
<span class="c"># command line argument. Convert to upper case to allow the user to</span>
<span class="c"># specify --log=DEBUG or --log=debug</span>
<span class="n">numeric_level</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">loglevel</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="bp">None</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">numeric_level</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'Invalid log level: </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">loglevel</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">numeric_level</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</code></pre></div> <p>也可以设置log file每次写之前清除原有内容：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">'example.log'</span><span class="p">,</span> <span class="n">filemode</span><span class="o">=</span><span class="s">'w'</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</code></pre></div> <p>上例中的getattr举例：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span><span class="s">'INFO'</span><span class="p">)</span>
<span class="mi">20</span>
<span class="c">#实际上就相当于：</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>
<span class="mi">20</span>
</code></pre></div> <p><strong>getattr的作用就是返回对象的属性值。</strong></p> <h2 id="logging-变量">logging 变量</h2> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">logging</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">my_name</span> <span class="o">=</span> <span class="s">'doing'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s is my name'</span><span class="p">,</span> <span class="n">my_name</span><span class="p">)</span>
<span class="n">INFO</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="n">doing</span> <span class="ow">is</span> <span class="n">my</span> <span class="n">name</span>
</code></pre></div> <p>和print的标准字符串很像，只是格式有一点差异，而且，logging的输出支持<code class="highlighter-rouge">str.format()</code>和<code class="highlighter-rouge">string.template</code>,这种用法，放在string的文章中详细介绍。</p> <h2 id="logging显示格式和显示时间">logging显示格式和显示时间</h2> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">logging</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">'</span><span class="si">%(asctime)</span><span class="s">s </span><span class="si">%(levelname)</span><span class="s">s:</span><span class="si">%(message)</span><span class="s">s'</span><span class="p">,</span> 
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">'Please notice the CPU utibily!'</span><span class="p">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mo">05</span> <span class="mi">12</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span><span class="mi">379</span> <span class="n">WARNING</span><span class="p">:</span><span class="n">Please</span> <span class="n">notice</span> <span class="n">the</span> <span class="n">CPU</span> <span class="n">utibily</span><span class="err">!</span>
</code></pre></div> <p>也可以更改时间格式：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">logging</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s">'</span><span class="si">%(asctime)</span><span class="s">s </span><span class="si">%(levelname)</span><span class="s">s:</span><span class="si">%(message)</span><span class="s">s'</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s">'</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">d/</span><span class="si">%</span><span class="s">Y </span><span class="si">%</span><span class="s">I:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S </span><span class="si">%</span><span class="s">p'</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">'Please notice the CPU utibily!'</span><span class="p">)</span>
<span class="mo">05</span><span class="o">/</span><span class="mo">05</span><span class="o">/</span><span class="mi">2017</span> <span class="mo">01</span><span class="p">:</span><span class="mo">06</span><span class="p">:</span><span class="mi">22</span> <span class="n">PM</span> <span class="n">WARNING</span><span class="p">:</span><span class="n">Please</span> <span class="n">notice</span> <span class="n">the</span> <span class="n">CPU</span> <span class="n">utibily</span><span class="err">!</span>
</code></pre></div> <p>更多的格式说明可以参考 <a href="https://docs.python.org/2/library/time.html#time.strftime">time.strftime()</a></p> <h1 id="3-介绍logging-module的各个object">3. 介绍logging module的各个object</h1> <p>logging模块主要包含几个部分：loggers, handlers, filters, formatters.</p> <h2 id="loggers">loggers</h2> <p>Logger 对象包括三类功能。<br /> 首先，提供几个方法接口以供应用调用并保存日志信息。<br /> 其次，根据重要性(默认筛选功能)或其他filter对象决定执行哪些log。<br /> 第三，logger 对象向其它相关的handler传递log。<br /> 总结起来，logger对象就是，保存log，筛选log和传递log，或者按照文档说法：<br /> 最普遍的用法有两方面： <strong>配置和消息发送。</strong><br /> logger的常用的<strong>配置</strong>方法：<br /> <code class="highlighter-rouge">Logger.setLevel()</code>，顾名思义，设置log级别<br /> <code class="highlighter-rouge">Logger.addHandler()</code>, Logger.removeHandler(),添加和删除handler对象给logger对象。<br /> <code class="highlighter-rouge">Logger.addFilter()</code>, Logger.removeFilter(), 添加，删除filter对象。<br /> <code class="highlighter-rouge">logging.getLogger()</code>,返回一个特定名字(默认为<code class="highlighter-rouge">root</code>)的logger实例的引用，名字是以<code class="highlighter-rouge">.</code>分隔的，有继承结构的。<br /> 当多个call以同一名字同时调用logging.getLogger()时，返回同一个logger对象。当名字时继承list里的下一级时，对应对象是上一级名字对应对象的继承。例如：logger 名字是<code class="highlighter-rouge">foo</code>的对象，是所有logger名字为<code class="highlighter-rouge">foo.tar</code>, <code class="highlighter-rouge">foo.file</code>, <code class="highlighter-rouge">foo.pdf</code>的上一级，后者是children。 <br /> 例如：<br /> <code class="highlighter-rouge">logger = logging.getLogger(__file__)</code> 返回的是名字为当前文件名的logger对象，配置完成后可以输出log: <code class="highlighter-rouge">logger.info('hi') </code></p> <p>Loggers 有一个explicit level的概念，就是Logger 对象必须有一个明确的级别，如果当前没有，则使用其父辈的level，一直往上找，直到找到<code class="highlighter-rouge">root</code>这个级别。这个级别用来决定当一个log事件发生时，是否将其传给handlers处理。</p> <p>子loggers用其父类的loggers的handler发送消息，所以，不用给每一个logger配置handler，只需要给最高级的logger配置即可，当然，也可以set <code class="highlighter-rouge">propagate</code> 为<code class="highlighter-rouge">False</code>.</p> <h2 id="handlers">Handlers</h2> <p>Hanlder 对象 负责分派合适的log信息(根据logger的level)给特定的目的地。Logger对象可以通过addHandler()方法添加0个或多个handler对象。举例，如果需要log发送给文件，stdout和email，则需要配置三个handler，分别处理一个每一个location。<br /> 常用的handler可以参考： <a href="https://docs.python.org/2.7/howto/logging.html#useful-handlers">Useful Handlers</a><br /> 最常用的handler： <br /> <strong>logging.FileHandler(filename, mode=’a’, encoding=None, delay=False)</strong> <br /> 将log以指定模式存进指定文件<br /> <strong>logging.StreamHandler(stream=None)</strong> <br /> 将log发送给标准流输出。</p> <h2 id="formatters">Formatters</h2> <p>Formatter对象配置log信息的最后顺序，结构和内容。formatter有两个可选参数，信息的格式字符串和日期格式字符串。<br /> <strong>logging.Formatter.__init__(fmt=None,datafmt=None)</strong><br /> 举例：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">sys_fmt</span> <span class="o">=</span> <span class="s">'</span><span class="si">%(asctime)</span><span class="s">s </span><span class="si">%(levelname)</span><span class="s">s </span><span class="si">%(filename)</span><span class="s">s:</span><span class="si">%(lineno)</span><span class="s">d </span><span class="si">%(processName)</span><span class="s">s MSGCLS=</span><span class="si">%(message)</span><span class="s">s'</span>
<span class="n">datefmt</span> <span class="o">=</span> <span class="s">'</span><span class="si">%</span><span class="s">Y</span><span class="si">%</span><span class="s">m</span><span class="si">%</span><span class="s">d</span><span class="si">%</span><span class="s">H</span><span class="si">%</span><span class="s">M</span><span class="si">%</span><span class="s">S'</span>
<span class="n">sys_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">sys_fmt</span><span class="p">,</span> <span class="n">datefmt</span><span class="p">)</span>
</code></pre></div> <p>如果没有message format string，则使用原始message，如果没有date format string，则使用如下格式： <code class="highlighter-rouge">%Y-%m-%d %H:%M:%S</code>后面再加上事件发生的毫秒数。 <br /> message format string的基本格式是<code class="highlighter-rouge">**%(&lt;dictionary key&gt;)s**</code>.如下例，列出了时间，级别和log内容：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="s">'</span><span class="si">%(asctime)</span><span class="s">s - </span><span class="si">%(levelname)</span><span class="s">s - </span><span class="si">%(message)</span><span class="s">s'</span>
</code></pre></div> <p>Formatters默认使用time.localtime(),如果需要，可以设置<code class="highlighter-rouge">converter</code>属性为time.gmtime()，显示GMT格式的时间。</p> <h1 id="概念有点乱上例子">概念有点乱，上例子</h1> <p>定义logger：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'my_log'</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</code></pre></div> <p>定义handler，这里既要存文件，又要打印输出：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">file_h</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s">'test.log'</span><span class="p">)</span>
<span class="n">file_h</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="n">console_h</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">console_h</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</code></pre></div> <p>定义formatter，这里更改了默认的时间格式，不想输出毫秒。</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s">'</span><span class="si">%(asctime)</span><span class="s">s - </span><span class="si">%(name)</span><span class="s">s - </span><span class="si">%(levelname)</span><span class="s">s - </span><span class="si">%(message)</span><span class="s">s'</span><span class="p">)</span>
<span class="n">formatter</span><span class="o">.</span><span class="n">datefmt</span><span class="o">=</span><span class="s">'</span><span class="si">%</span><span class="s">Y/</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">d </span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S'</span>
</code></pre></div> <p>把formatter给set给handler，再把handler赋给logger</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">file_h</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">console_h</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_h</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_h</span><span class="p">)</span>
</code></pre></div> <p>最后 打印log：</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">'cool'</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">'bad'</span><span class="p">)</span>
</code></pre></div> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://localhost:4000/2017/05/05/Python-library-logging.html&text=Python标准库 -- logging" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://localhost:4000/2017/05/05/Python-library-logging.html&title=Python标准库 -- logging" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://localhost:4000/2017/05/05/Python-library-logging.html&title=Python标准库 -- logging" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="comment container"> <div id="disqus_thread"> </div> </div> <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Buit with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu" class="open"> <span id="menu-icons"></span> </button> <button id="post-toc-menu"> <span id="post-toc-menu-icons"></span> </button> <div id="post-toc"> <span id="post-toc-title">Table of Contents</span> <ul id="post-toc-ul"></ul> </div> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-54767140-1', 'doing.cool'); ga('send', 'pageview'); </script> </body> </html>
